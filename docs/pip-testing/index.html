<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="js/lib.js"></script>

    <!--
        TODO: UI. Have a pip color chooser that lets you choose from the 5 colors. Have a data field for the number 
                  with an up/down. Allow you to add new rows for new pips, and there are three columns. 
                  Pip color chooser also needs a 'no pip' option.
        TODO: UI. Be able to save a result so you can compare later. 
        TODO: UI. Want to do charting. This coulde include showing the charting of all values calculated, with the 
                  ones where the operator was true in a different colour. Also could be a chart for the saved tests.
                  This will involve various rejigging in the engine of the code.
        TODO: Some kind of best fit notion. Have it run over the flips looking for the best return value.
              This involves indicating something is variable. 
              One approach is to indicate the deck as WG*BK*, and it will adjust those numbers, keeping a max of 40.
              It could know the counts for how many of each pip type there are. Or maybe just the ones that have less 
              than 14 cards. 
        TODO: Load pips from FM. Maybe file upload (into browser?) an OCTGN file, and it has its own json file 
              with the pips on each card.
        TODO: Automatic tables for pip-patterns. ie:   W3:12O37:28 would calculate multiple times over to form a table.
              Or should it be more specific, i.e.:    range(W,3,12) range(O,37,28). A fourth parameter could be the step.
              Ranges would lead to tables being output, which would include the pattern as a first column and the number 
              of cards as a second. 
    -->


    <script>
        function test_from_form() {
            flip_count=parseInt($("#flip_count").val() );
            iteration_count=parseInt( $("#iteration_count").val() );
            queries=$("#query").val().split(',');
            pip_pattern=$("#pip_pattern").val();
            // colours(*)=4
            pip_set = pattern_to_pip_set(pip_pattern);
            //console.log("Running: run_test(" + pip_set_to_pattern(pip_set) + ", " + query + ", " + iteration_count + ", " + flip_count + ")");
            results = run_test( pip_set, queries, iteration_count, flip_count );

            text = "";
            for (let i = 0; i < results.length; i++) {
                text += queries[i] + " &rarr; " + format_result(results[i], queries[i]) + "<br/>";
            }

            $("#percentage_result").html(text);
            return false;
        }
    </script>
    </head>
    <body>
<h2>Pip Tester</h2>

    <form>
        <label>Deck Pips (eg: WG12 OK28)</label><input id="pip_pattern"/><br/>
        <label>Flips (eg: flip X cards)</label><input id="flip_count"/><br/>
        <label>Iterations (how many times to test)</label><input id="iteration_count"/><br/>
        <label>PIPQL Query (eg: colours(*)=4)</label><input id="query"/><br/>
        <button type="button" onClick="test_from_form()">Calculate</button>
    </form>
    <br/><br/>
    <span id="percentage_result"></span>

    <h3>PIPQL Help</h3>
    <p>There are currently two functions available in PIPQL: </p>
    <ol>
        <li>count. This counts the number of times a pip shows. Its parameter is unique, so count(O) is the same as count(OO); that is the second O is meaningless. Using count(*) is a shorthand to count all pips that show.  </li>
        <li>colours/colors. This counts the number of times a colour shows. Again the parameter is unique, so colours(OO) matches colours(O). colours(*) counts all the colours, colours(OB) would count how often an O or B shows. colours(OB) will never be greater than 2; as an example. </li>
    </ol>

    <p>Compound queries can be entered above in two ways. They can be joined together with ' AND ' to form the same query (see Ultra Magnus example below), or they can be run in parallel by separating with a comma. </p>
    <p>If a query has an operator, it will let you know the %age of times that that operation is true. i.e. '=4' will tell you how often the answer was 4. </p>
    <p>If a query does not have an operator, it will return the average (mean) of the values calculated. </p>
    <p>Whitespace is allowed in queries to improve readability. </p>

    <h3>Deck Format</h3>
    <p>Decks are described (until a nicer UI is made) as pieces of text consisting of the pips on a card type, followed by the number of those cards. O=Orange, B=Blue, K=Black, W=White, G=Green. Whitespace is allowed to improve readability. </p>

    <h3>PIPQL Examples</h3>
    <ul>
        <li>Grapple flipping two pips:  colours(*)=4</li>
        <li>Chromia flipping at least WW: count(W)&gt;1</li>
        <li>Ultra Magnus flipping OOBB: count(O)&gt;=2 AND count(B)&gt;=2</li>
        <li>Fortress Maximus flipping OK: colours(OK)=2</li>
        <li>Private Red Alert flipping WOB: colours(WOB)=3</li>
        <li>Slipstream flipping &gt;2 colours: colours(*)&gt;2</li>
        <li>Average number of orange/black in a flip: count(O),count(K)</li>
    </ul>

    <h3>Provisos</h3>
    <p>Enter weird input, you'll get weird behaviour. Enter a huge number of iterations, your browser will lock up. 100000 is probably as high as you want/need to go. It is also probably very brittle. Extra whitespace may throw it for example. </p>

    </body>
    </html>
