<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="icon" href="/favicon.png"></link>
        <link rel="stylesheet" type="text/css" href="../style/style.css"></link>
        <link rel="stylesheet" type="text/css" href="style/style.css"></link>
        <title>Grapple's Flippin' Pippalizer</title>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script src="js/lib.js"></script>
        <script src="js/ui.js"></script>
        <script>
            function toggleHelp(help_id) {
                $( "#" + help_id ).toggle('show');
            }
        </script>
        <script src="guid_to_pip.js"></script>
    </head>

    <!--
        TODO: UI. Have a pip color chooser that lets you choose from the 5 colors. Have a data field for the number 
                  with an up/down. Allow you to add new rows for new pips, and there are three columns. 
                  Pip color chooser also needs a 'no pip' option.
        TODO: UI. Be able to save a result so you can compare later. 
        TODO: UI. Want to do charting. This coulde include showing the charting of all values calculated, with the 
                  ones where the operator was true in a different colour. Also could be a chart for the saved tests.
                  This will involve various rejigging in the engine of the code.
        TODO: Some kind of best fit notion. Have it run over the flips looking for the best return value.
              This involves indicating something is variable. 
              One approach is to indicate the deck as WG*BK*, and it will adjust those numbers, keeping a max of 40.
              It could know the counts for how many of each pip type there are. Or maybe just the ones that have less 
              than 14 cards. 
        TODO: Load pips from FM. Maybe focus on the OCTGN file format and allow one to upload it. Would need to turn the OCTGN set.xml files into a json file of card to pip letter. 
        TODO: Update the Chosen Deck from the Pip Pattern via an Apply. Then change the code to always look at the Chosen Deck section. OCTGN could also load into that.
        TODO: Automatic tables for pip-patterns. ie:   W3:12O37:28 would calculate multiple times over to form a table.
              Or should it be more specific, i.e.:    range(W,3,12) range(O,37,28). A fourth parameter could be the step.
              Ranges would lead to tables being output, which would include the pattern as a first column and the number 
              of cards as a second. 
        TODO: Make white=+2 a default-on option. 
        TODO: Show a running total in the Chosen Deck section.
    -->

    </head>
    <body>
        <!--<h1 id='sitetitle'><a href="../index.html">Freelance Peace Keeping</a></h1> -->
<h1 id='sitetitle'><a href="../index.html">Grapple's Flippin' Pippalizer</a></h1>
<div class="content" style="width: 90%;">

<p class="commentary">"I don't always plan my attacks, but when I do, I always use Grapple's Frippling Pippalizer.... erm, Pappling Flappalizer.... gah, This Page!! (These endorsements pay, yes?)"</p>

<div class="article" style="background-image: url('img/GrappleTruck.jpg'), url('img/GrappleBot.jpg'); background-repeat: no-repeat; background-position: left -10px, right -10px;">

<br/>
<br/>
<br/>
<br/>


<div style="width: 98%; margin-left:auto; margin-right:auto;">

            <ul class="nobullet tightlist">
                <li>
                    <fieldset style="background-color: white">
                    <legend style="background-color: white; border-radius: 6px;">Deck</legend>
                    <span class="help">
                        <input type="image" onclick="toggleHelp('help-deck');" src="img/help-circle.svg" class="help-icon"/>
                        <span class="help-text" id="help-deck">
                            Here you add pip sets to your deck. You select the colours of pips and then enter the number of cards in the Static section, or use the Varying section to create a range for that pip set. When you hit Add, they'll appear in the Chosen Deck section. Be careful with Varying to plan your ranges so your total deck size is as you intend it to be (usually 40). 
                        </span>
                    </span>
              <ul class="nobullet">
                  <li>
              <fieldset>
                  <legend>Generate Battle Icons</legend>
                  <select id="battleicons1">
                      <option value="X"></option>
                      <option value="W">White</option>
                      <option value="O">Orange</option>
                      <option value="K">Black</option>
                      <option value="B">Blue</option>
                      <option value="G">Green</option>
                  </select>
                  <select id="battleicons2">
                      <option value="X"></option>
                      <option value="W">White</option>
                      <option value="O">Orange</option>
                      <option value="K">Black</option>
                      <option value="B">Blue</option>
                      <option value="G">Green</option>
                  </select>
                  <select id="battleicons3">
                      <option value="X"></option>
                      <option value="W">White</option>
                      <option value="O">Orange</option>
                      <option value="K">Black</option>
                      <option value="B">Blue</option>
                      <option value="G">Green</option>
                  </select>
              <fieldset>
                  <legend>Static</legend>
                  <label for="card_count">Count:</label>
                  <input id="card_count"/>
                  <input type="button" value="Add" onClick="add_pipset()"/>
              </fieldset>
              <fieldset>
                  <legend>Varying</legend>
                  <label for="varying_start">Start:</label>
                  <input id="varying_start" size="2"/>
                  <label for="varying_end">End:</label>
                  <input id="varying_end" size="2"/>
                  <label for="varying_step">Step:</label>
                  <input id="varying_step" value="1" size="2"/>
                  <br/>
                  <input type="button" value="Add Range" onClick="add_ranged_pipset()"/>
              </fieldset>
              </fieldset>
                    <span class="help">
                        <input type="image" onclick="toggleHelp('help-pip-pattern');" src="img/help-circle.svg" class="help-icon"/>
                        <span class="help-text" id="help-pip-pattern">
                            The Pip Pattern is an Experts feature. Rather than building the deck, you can enter it in one go. For example, "W6 G4 OK15 BK15" would be a deck with 6 white, 4 green, 15 orange-black, and 15 blue-black pipped cards. An example range is "B3:15:2" to indicate varying the blue-pip count from 3, to 15, in steps of 2. X is recommended for no-pip cads. 
                        </span>
                    </span>
              <fieldset>
                  <legend>Pip Pattern</legend>
                  <label>Text:</label>
                  <input id="pip_pattern"/>
                  <br/>
                  <label>Load Pattern from .o8d File:</label>
                  <input type="file" id="files" name="files" accept=".o8d"/>
              </fieldset>
                  </li>
              </ul>
          </fieldset>
          </li>

          <li>
              <fieldset style="background-color: white">
                  <legend>Chosen Deck</legend>
                  <span class="help">
                      <input type="image" onclick="toggleHelp('help-chosen-deck');" src="img/help-circle.svg" class="help-icon"/>
                      <span class="help-text" id="help-chosen-deck">
                          As you add static or varying pip sets to your deck, they appear here. 
                      </span>
                  </span>
                  <ul class="nobullet tightlist" id="chosen_deck">
                  </ul>
              </fieldset>
          </li>
          <li>
          <fieldset style="background-color: white">
              <legend>Query</legend>
              <span class="help">
                  <input type="image" onclick="toggleHelp('help-query');" src="img/help-circle.svg" class="help-icon"/>
                  <span class="help-text" id="help-query">
                      You can set the number of times to test (10000 or 100000 are recommended), how many cards to flip, and pick from various standard queries. You can also write your own query. <br/><br/>
                      See <a target="pipql_manual" href="pipql-manual.html">the manual</a> for more details on PIPQL. 
                  </span>
              </span>
              <label for="iterations">Iterations:</label>
              <input id="iterations" value="10000" size="6"/>
              <label for="flip">Flip:</label>
              <input id="flip" value="2" size="2"/>
              <br/>
              <label for="canned">Canned Queries:</label>
              <select id="canned" onchange="replace_pipql('canned')">
                  <option value=""></option>
                  <option value="count(O),count(K)">Average number of orange/black in a flip</option>
                  <option value="colours(WOKB)=4">Cerebros flipping WOKB</option>
                  <option value="count(W)&gt;=2">Chromia flipping at least WW</option>
                  <option value="count(O)&gt;=2">Electrified Spikes flipping OO</option>
                  <option value="colours(OK)=2,colours(BW)=2">Fortress Maximus flipping OK and BW</option>
                  <option value="colours(*)=4">Grapple flipping 4 colours</option>
                  <option value="count(O),colours(*)">Masters of Metallikato</option>
                  <option value="count(O)&gt;=2 AND count(B)&gt;=2 AND count(W)&gt;=2">Metroplex flipping WWOOBB</option>
                  <option value="colours(WOB)=3">Private Red Alert flipping WOB</option>
                  <option value="colours(*)&gt;2">Slipstream flipping &gt;2 colours</option>
                  <option value="count(O)&gt;=2 AND count(B)&gt;=2">Ultra Magnus flipping OOBB</option>
              </select>
              <br/>
              <label for="pipql" style="display: block;">PIPQL Query:</label>
              <textarea id="pipql" rows="6" cols="80" style="display: block;"></textarea>
              <button type="button" onClick="test_from_form()">Run Query</button>
          </fieldset>
          </li>

          <!--
        TODO: Canned queries:
        Megatron, Fallen Hero; Energized Field O >= 1
        Turbo Board, Galaxy Prime, Drag Strip, Blitzwing O >= 1 AND B >= 1
        Private Red Alert, Opt Prime Gleaming, Silverbolt, Bluestreak O >= 1 AND B >= 1 AND W >= 1
        Overwhelming Advantage at least WOKBG
        Fuel Cache at least WOB  (no white)
        Cindersaur OOOO
        Sparkstalker OOO
        Shock Absorbers, Cybertronian Bow O and B equal (not supported yet?)
        Swarm 

        Breakdown, Sgt Chromia B >= 2
        Nautica, Whirl B >=1
        Mirage B >= 1
        Aimless B >= 3
        
        Skywarp Sneaky, Hound, Acute Reflexes, Erratic Cannon, Spinner Rims, Adaptive Plating, Slug-W2 W >= 1
        Plasma Horns count(W),W>=4
        Chromia Special ops, Bumblebee (Courageous Scout), Jazz, Bike Gang, Pteraxadon W >= 2
        Mirage W>=3

        Swoop-W2, Wolfwire, Tailwind G >= 1
        Raider Chop shop G >= 1.  (Need an Exact Match as well; like:   exactly('G') )

        Sgt Thundercracker Bot, Mindwipe, RR Disruptor Blade, Composite Armor K >= 1
        Nightstick K >= 2
        Concealing Contrails count(K)
        Sgt Thundercracker Alt count(K)   (No white +2)

        Windblade flip-deck, is it more than 2-pipped?     (though this is a simple probablity one)
        Versatility, chance of 1 battle icon, and colours(*)
        Brawn, pierce 1 for each different color, +1 def for each different color
        Ratbat, repair 1 for each different color
        Lucky Vest, at least 4 different color
        Smashdown, average number of colors flipped
          -->


          <!--
              TODO: Special situations:
              Wearing Inverted.  Also W5 Belligerence/End Hostilities
              Turn off white => 2
              Rescue Patrol White
              Slug White
           -->




<li>
<br/> <br/> 
    <fieldset>
        <span class="help">
            <input type="image" onclick="toggleHelp('help-results');" src="img/help-circle.svg" class="help-icon"/>
            <span class="help-text" id="help-results">
                Your results appear here. You will get multiple rows if you used a varying range in one of your pipsets. 
            </span>
        </span>
        <legend>Results</legend>
        <table id="pip_results"></table>
    </fieldset>
</li>
</ul>

    </div>

    </div>

    </div>

<p class="footer">Comic Book images courtesy of tfwiki.net under <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA-3.0</a>.  Icons MIT licensed from <a href="https://feathericons.com/">https://feathericons.com</a>.</p>






<script>
  function handleFileSelect(evt) {
      var file = evt.target.files[0];   // FileList object
      var reader = new FileReader();

      reader.onload = (function(theFile) {
        return function(e) {
            txt = e.target.result;
            parser = new DOMParser();
            xmlDoc = parser.parseFromString(txt, "text/xml");
            deck = xmlDoc.getElementsByTagName("section")[1];
            pip_set = {};
            for ( card of deck.getElementsByTagName("card") ) {
                guid = card.getAttribute('id');
                qty = parseInt(card.getAttribute('qty'));
                pips = "X";
                if ( GUID_TO_ICONS[guid] ) {
                    pips = GUID_TO_ICONS[guid];
                }
                if ( pip_set[pips] ) {
                    pip_set[pips] += qty;
                } else {
                    pip_set[pips] = qty;
                }
            }

            $("#pip_pattern").val( pip_set_to_pattern(pip_set) );
        };
      })(file);

      reader.readAsText(file);
  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>
    </body>
    </html>
